여러 개의 엔드포인트에 대해

## [AWS Lambda] 여러 개의 람다 함수 vs 하나의 람다 함수

### 1. 여러 개의 람다 함수

 즉, **엔드포인트 각각 하나마다 하나의 람다 함수가 처리하는 방식**이다. API 엔드포인트 하나가 늘어날 때마다 람다 함수 하나를 새로 만들고 설정해줘야 하기 때문에 비효율적으로 보일 수 있다. 하지만, 여러 장점도 있다.

>1번 방식의 장점
>
>1. endpoint마다 람다 함수가 독립적으로 실행되므로 어느 한 람다에 문제가 생겨도 다른 엔드포인트에 영향을 끼치지않는다.
>
>2. 람다가 사용하는 자원을 효율적으로 배분할 수 있다.
>
>  -> 람다 실행 시 메모리, 시간 등에 대한 설정을 각 엔드포인트의 상황에 맞게 설정이 가능하다.

 이 밖에도 1번 방식은 보안 이슈와 람다의 제한 시간, 크기 등에 대한 이슈 등에서 장점을 가지고 있다.

<br>

### 2. 하나의 람다 함수

 **여러 엔드포인트를 하나의 람다 함수가 처리**하여 그 람다 함수 내부에서 라우팅으로 처리하는 모델이다. 1번 모델의 장점이 단점으로 작용한다(그 반대도).

> 2번 방식의 장점
>
> 1. 엔드포인트가 매우 많은 경우, 수 많은 람다 함수가 생성되는 것을 막을 수 있고 관리하기에도 편할 것이다.
> 2. 공통으로 사용되는 모듈이나 서비스를 엔드포인트가 공유할 수 있다.

<br>

 AWS에서도 2번(여러 엔드포인트를 한 개의 람다로 처리)보다 1번을 권장하는 편이다. [참고자료(AWS re:Invent 2019)](https://youtu.be/TOn0xhev0Uk?t=1254)

<br>

-------------------------------------------------

<br>

## [AWS Lambda] 동시성

### 1. 목표

 람다의 콜드스타트 시간 최소화하기

<br>

### 2. 콜드 스타트(Cold Start)

 사용자가 람다 함수를 호출하면 AWS는 실행 환경을 준비한다. 사용자의 코드를 다운로드하고, 메모리, 런타임 등 설정 내용대로 지정된 구성을 만든다. 이 작업이 완료되면 코드를 실행하기 전에 초기화 코드를 실행한 후에 람다 핸들러 코드를 실행한다.

> **코드 다운로드 -> 실행 환경 구성 -> 초기화 코드 실행 -> 핸들러 코드 실행**

 여기서 앞에 두 단계 **코드 다운로드와 실행 환경 구성에 걸리는 시간을 콜드스타트 시간**이라 한다.

 람다 함수는 한번 실행이 완료되면 정해지지 않은 시간(랜덤?)동안 실행 환경을 고정한다. 그래서 두 번째 실행부터는 코드를 다운로드하고 환경을 구성할 필요가 없으므로 좀 더 빠르게 실행된다.(**웜 스타트**)

 AWS에서 콜드 스타트 시간을 최소화를 위해 람다 함수의 동시성을 구성할 수 있도록 해준다. 

<br>

### 3. 동시성

 람다에서 동시성은 주어진 시간에 함수가 제공하는 요청 수를 말한다. 즉, 요청이 처리되는 동안 함수가 다시 호출되면 다른 인스턴스가 할당되어 동시성이 증가한다. 람다 함수에서 두 가지 유형의 동시성 제어가 가능하다.

>1. **예약된 동시성**
>
>  - 함수의 최대 인스턴스 수를 보장
>  - 한 함수가 동시성을 예약한 경우 다른 함수는 동시성을 사용할 수 없음
>  - 추가 요금은 없음
>  - 해당 함수의 버전 및 별칭을 포함하여 함수 전체에 적용
>
>2. **프로비저닝된 동시성**
>
>  - 요청된 수의 실행 환경을 초기화하여 함수 호출에 즉시 응답할 수 있도록 준비
>  - 추가 요금 발생 → 너무 비쌈..

<br>

**참고자료**

- [람다 성능 최적화](https://docs.aws.amazon.com/lambda/latest/operatorguide/perf-optimize.html)
- [람다 동시성](
